[b][size=140]Форматы файлов[/size][/b]

dat - архивы игры
scr - скрипты (идентификатор BSF1)
bmp - графика
ega - графика для EGA режима (16 цветов)
ant - имеет какое-то отношение к лицам персонажей на панели диалога

[b][size=140]Архивы игры (*.dat)[/size][/b]

Структура: [code][Смещение 1го файла][Таблица файлов][Файлы][/code]
[code][Смещение 1го файла]
4 байта: смещение первого файла в архиве
[Таблица файлов]
4 байта: длина записи в таблице
4 байта: нули
4 байта: смещение файла
4 байта: размер файла
n байт: путь и имя файла (n = длина записи - 32 байта)
[Файлы]
Лежат, как есть, друг за другом.[/code]

[b][size=140]Скрипты (*.scr)[/size][/b]

Структура: [code][Заголовок][Таблица меток][Байт-код][/code]
Заголовок: BSF1
Таблица меток:
[code][Название метки][00][Адрес перехода]
Название метки: строка из символов латиницы, цифр и нижнего подчёркивания.
Адрес перехода: 4 байтовое целое.[/code]
[list][*]Как только в скрипте встречается текст совпадающий с названием метки, происходит переход по адресу из таблицы.
[*]Метки используются для перехода внутри одного скрипта, для передачи управления в другой используется опкод [11].
[*]Если очередная последовательность байт не опкод и не название метки, то это текст для вывода на экран. Исключение имена персонажей: они выводятся с помощью опкода [02].
[*]Имена файлов пишутся без расширений и путей.[/list]

[b][size=140]Опкоды[/size][/b]

[b]Изученные:[/b]

[code]00 - разделитель и символ переноса на новую строку в тексте диалогов. Ставится после опкодов, параметров и строк.
01 - показать спрайт с лицом персонажа на панели диалога [01][00][Имя BMP со спрайтом][00]
02 - показать/изменить/убрать имя персонажа на панели диалога [02][00][Имя][00]
03 - ожидать нажатия кнопки мыши или Enter [03][00]
04 - загрузить фон [04][00][Имя BMP с фоном][00]
05 - показать спрайт персонажа поверх фона (постепенно) [05][00][Имя BMP со спрайтом][00]
06 - проявление фона (fade in) [06][00][1 байт: скорость][00]
07 - затухание фона (fade out) [07][00][1 байт: скорость][00]
08 - эффект вспышки (проявление) [08][00][1 байт: скорость][00]
09 - эффект вспышки (засветление) [09][00][1 байт: скорость][00]
0A - задержка [0A][00]
0B - действует как замедленный выход [0B][00][1 байт: задержка][00]
11 - передать управление другому скрипту [11][00][Имя файла скрипта][00][Метка перехода][00]
12 - показать рамку диалога выбора [12][00][1 байт: число вариантов (n)][00][текст 1][00]..[текст n][00]
19 - case of label (множественный выбор перехода) [19][00][1 байт: кол-во вариантов][label1][00][label2][00]...[00]
В качестве входного значения, по-видимому, использует какой-то внутренний регистр скриптового движка.
1D - убрать с экрана панель диалога [1D][00]
1E - убирает панель диалога и воспроизводит звуковой эффект [1E][00][Имя mp3 файла][00]
25 - воспроизвести звук [25][00][Имя mp3 файла][00]
26 - показать спрайт персонажа поверх фона; +: добавить к предыдущему [26][00][(+)Имя BMP со спрайтом][00][/code]

[b]Вызывающие сомнение:[/b]

[code]20 - заливает фон цветом [20][00][1 байт: цвет][00] (01 - белый, 02 - красный, в остальных случаях возвращает предыдущий фон)
27 - вызвало выключение фоновой музыки (18? байт по параметры вместе с нулями)
2A - звездочка (*) Возможно, переданная в качестве параметра опкоду, отменяет действия предыдущего такого же опкода[/code]

[b]Плохо изученные:[/b]

[code]0C - встречается обычно в блоках test после него идет метка
10 - //возвращает на предыдущую сцену или ничего не делает
13 - [13][00][4 байта: параметры]
14 - [14][00][4 байта: параметры]
15 - [15][00][4 байта: параметры]
16 - [16][00][4 байта: параметры]
17 - [17][00][4 байта: параметры]
18 - [18][00][4 байта: параметры]
1A - прячется панель диалога, играет фоновая музыка, игра зависает
1B - играет фоновая музыка, игра зависает
1C - [1C][00][4 байта: параметры]
1F - [1F][00][1 байт: параметр][00]
21 - [21][00][4 байта: параметры]
22 - //размер непонятен
23 - как 22
24 - [24][00][1 байт: параметр][00]
28 - ХЗ
29 - ХЗ
2B - ХЗ
2C - ХЗ
2D - [2D][00][1 байт: параметр][00]
2E - [2E][00][4 байта: параметры]
2F - [2F][00][4 байта: параметры][/code]

[b]Может они есть, а может их и нет:[/b]
[code]30-7F - нет
80 - ХЗ
81-FF - нет[/code]

[size=140]Инструменты[/size]

[b]Архивы[/b]: распаковщик - AnimeED, запаковщик - своя утилита.
[b]Скрипты:[/b] свои утилиты для дампа текста из скрипта и его рекомпиляции (вставка текста в оригинальный скрипт и исправление таблицы меток).